import random

from mainapp.processing.declension_numbers import decl_scores, decl_places
from mainapp.processing.handle_common_rating import get_user_common_rating_info
from mainapp.processing.handle_userprofile import get_scores_rating
from mainapp.processing.handlers.proc_response_obj import remove_tts_symbols


def my_rating(session_state: dict, user_id: str, session_id: str) -> dict:
    """
    –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—â–∏–π –∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç:
        -–Ω—É–ª–µ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥;
        -–Ω–µ–Ω—É–ª–µ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥;
    –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–∑–≤—É—á–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–Ω—ã–π.
    –í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –æ—Ç–¥–∞–µ—Ç –µ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –≤ –æ—Ç–≤–µ—Ç (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –º–µ—Å—Ç–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞), –Ω–æ —É–∂–µ —Å —Ñ–ª–∞–≥–æ–º –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞.
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—Ç–≤–µ—Ç —Ñ–ª–∞–≥–∞ AppMetrics: "–ó–∞–ø—Ä–æ—Å '–†–µ–π—Ç–∏–Ω–≥'"
    """
    user_place_score, rating_table_print = get_user_common_rating_info(user_id)
    cur_scores = get_scores_rating(user_id, session_id)
    allscores = cur_scores["allscores"]
    sessionscore = cur_scores["sessionscore"]
    user_place = user_place_score[0]

    rating_head = f'üèÖüèÖüèÖ–í–∞—à —Ä–µ–π—Ç–∏–Ω–≥üèÖüèÖüèÖ\n\n–û–±—â–∏–π —Å—á—ë—Ç: {allscores}. –ó–∞ —ç—Ç—É –∏–≥—Ä—É: {sessionscore}\n\n' \
                  f'{rating_table_print}'

    rating_tts_only, rating_message = get_place_phrase(user_place, allscores)

    if not rating_tts_only:
        rating_tts_only = random.choice(
            [
                f'–°–µ–π—á–∞—Å –∑–∞ –∏–≥—Ä—É {decl_scores(sessionscore)} sil <[100]>–∏ {decl_scores(allscores)} –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è.sil <[100]>\n',
                f'–°–µ–π—á–∞—Å —É —Ç–µ–±—è {decl_scores(sessionscore)} –∑–∞ –∏–≥—Ä—É sil <[100]>–∏ {decl_scores(allscores)} –≤ —Ü–µ–ª–æ–º.sil <[100]>\n',
                f'–£ —Ç–µ–±—è –∑–∞ –∏–≥—Ä—É {decl_scores(sessionscore)} sil <[100]>–∏ –≤—Å–µ–≥–æ {decl_scores(allscores)}.sil <[100]>\n',
                f'–ó–∞ –∏–≥—Ä—É —É —Ç–µ–±—è {decl_scores(sessionscore)}, sil <[100]>–∞ –≤—Å–µ–≥–æ {decl_scores(allscores)}.sil <[100]>\n',
                f'–í—Å–µ–≥–æ {decl_scores(allscores)}, sil <[100]>–∞ –∑–∞ —ç—Ç—É –∏–≥—Ä—É {decl_scores(sessionscore)}.sil <[100]>\n'
                ])

    response: dict = {
        'text': remove_tts_symbols(f'{rating_head} \n{rating_message}'),
        'buttons': [
            {'title': '–î–∞', 'hide': 'true'},
            {'title': '–ù–µ—Ç', 'hide': 'true'}
        ],
        'tts': f'{rating_tts_only}{rating_message}',
        'end_session': 'false'
    }

    # –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –æ—Ç–≤–µ—Ç–æ–º –ø–µ—Ä–µ–¥–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥ –î–∞/–ù–µ—Ç
    sessionstate = session_state
    sessionstate["yesno_type"] = 10

    analytics = {
            "events": [
                {
                    "name": "–ó–∞–ø—Ä–æ—Å '–†–µ–π—Ç–∏–Ω–≥'",
                },
            ]
        }

    return {
        "response": response,
        "analytics": analytics,
        "session_state": sessionstate
    }


def get_place_phrase(user_place: int, user_scores: int):
    rating_tts_only = ''
    rating_message = ''
    if user_place == 1:
        rating_message += random.choice(
            ["–¢—ã –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ! sil <[70]>–ú–æ–ª–æ–¥—á+–∏–Ω–∞! –ü—Ä–æ–¥+–æ–ª–∂–∏–º –±–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã?",
             "–¢—ã –ø+–µ—Ä–≤—ã–π –≤ –æ–±—â–µ–º —Ä–µ–π—Ç–∏–Ω–≥–µ! –¢–æ–ª—å–∫–æ –≤–ø–µ—Ä–µ–¥! sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º?",
             "–ù–µ –ø–æ–Ω–∏–º+–∞—é, –∫–∞–∫ —Ç–µ–±–µ —ç—Ç–æ —É–¥–∞–ª–æ—Å—å, sil <[70]>–Ω–æ —Ç—ã –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ! –ü—Ä–æ–¥+–æ–ª–∂–∏–º –∏–¥—Ç–∏ –≤–ø–µ—Ä—ë–¥?",
             "–¢—ã –ª—É—á—à–∏–π! sil <[70]> –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å. –°–æ–ø–µ—Ä–Ω–∏–∫–∏ –Ω–µ –¥—Ä–µ–º–ª—é—Ç. sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º?"
             ])

    elif user_place == 2:
        rating_message += random.choice(
            ["–¢—ã –≤ –ø—Ä–∏–∑–æ–≤–æ–π —Ç—Ä–æ–π–∫–µ, sil <[70]>–Ω–æ –Ω–µ –≤—Ä–µ–º—è —Ä–∞—Å—Å–ª–∞–±–ª—è—Ç—å—Å—è. sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º?",
             "–¢—ã –≤—Ç–æ—Ä+–æ–π! –¢–æ–ª—å–∫–æ –≤–ø–µ—Ä–µ–¥! sil <[100]>–ü—Ä–æ–¥–æ–ª–∂–∏–º?",
             "–¢—ã –≤—Ç–æ—Ä+–æ–π –∏ –Ω–∞—Å—Ç—É–ø–∞–µ—à—å —á–µ–º–ø–∏–æ–Ω—É –Ω–∞ –ø—è—Ç–∫–∏! sil <[100]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º –∏–¥—Ç–∏ –≤–ø–µ—Ä—ë–¥?",
             "–¢—ã –≤—Ç–æ—Ä+–æ–π!sil <[70]> –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å. sil <[100]>–°–æ–ø–µ—Ä–Ω–∏–∫–∏ –Ω–µ –¥—Ä–µ–º–ª—é—Ç. –ü—Ä–æ–¥+–æ–ª–∂–∏–º?",
             "–¢—ã –Ω–∞ –≤—Ç–æ—Ä–æ–º –º–µ—Å—Ç–µ! –Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –±—ã–ª –ª—É—á—à–∏–º! sil <[100]>–ü–æ–≥–Ω–∞–ª–∏ –¥–∞–ª—å—à–µ?"
             ])

    elif user_place == 3:
        rating_message += random.choice(
            ["–¢—ã –≤ –ø—Ä–∏–∑–æ–≤–æ–π —Ç—Ä–æ–π–∫–µ, sil <[70]>–Ω–æ –Ω–µ –≤—Ä–µ–º—è —Ä–∞—Å—Å–ª–∞–±–ª—è—Ç—å—Å—è. sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º?",
             "–¢—ã —Ç—Ä+–µ—Ç–∏–π! sil <[70]>–¢–æ–ª—å–∫–æ –≤–ø–µ—Ä–µ–¥! sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º?",
             "–¢—ã —Ç—Ä+–µ—Ç–∏–π –∏ –Ω–∞—Å—Ç—É–ø–∞–µ—à—å —á–µ–º–ø–∏–æ–Ω—É –Ω–∞ –ø—è—Ç–∫–∏! sil <[70]>–ü—Ä–æ–¥–æ–ª–∂–∏–º –∏–¥—Ç–∏ –≤–ø–µ—Ä—ë–¥?",
             "–¢—ã —Ç—Ä+–µ—Ç–∏–π!sil <[70]> –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å. sil <[70]>–°–æ–ø–µ—Ä–Ω–∏–∫–∏ –Ω–µ –¥—Ä–µ–º–ª—é—Ç. –ü—Ä–æ–¥+–æ–ª–∂–∏–º?",
             "–¢—ã –Ω–∞ —Ç—Ä+–µ—Ç—å–µ–º –º–µ—Å—Ç–µ! sil <[70]>–ù–æ —è —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –±—ã–ª –ª—É—á—à–∏–º! sil <[70]>–ü–æ–≥–Ω–∞–ª–∏ –¥–∞–ª—å—à–µ?"
             ])

    elif int(user_scores) != 0:
        rating_tts_only += random.choice(
            [f"–¢—ã –Ω–∞ {decl_places(user_place)} –º–µ—Å—Ç–µ.sil <[70]>",
             f"–¢–µ–ø–µ—Ä—å —Ç—ã –Ω–∞ {decl_places(user_place)} –º–µ—Å—Ç–µ.sil <[70]>",
             f"–ò –≤–æ—Ç —Ç—ã –Ω–∞ {decl_places(user_place)} –º–µ—Å—Ç–µ. sil <[70]>",
             f"–°–µ–π—á–∞—Å —Ç—ã –Ω–∞ {decl_places(user_place)} –º–µ—Å—Ç–µ. sil <[70]>"
             ]
        )

        rating_message += random.choice(
            ['–≠—Ç–æ –≤–µ—Å—å–º–∞ —Ö–æ—Ä–æ—à–æ. –ü—Ä–æ–¥–æ–ª–∂–∏–º –∏–¥—Ç–∏ –≤–ø–µ—Ä—ë–¥?',
             '–û—á–µ–Ω—å –Ω–µ–ø–ª–æ—Ö–æ! –ü—Ä–µ–¥–ª–∞–≥–∞—é –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ–º. –ü—Ä–æ–¥+–æ–ª–∂–∏–º –∏–≥—Ä—É?',
             '–£–≤–µ—Ä–µ–Ω–∞, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –±–æ–ª—å—à–µ. –ü—Ä–æ–¥+–æ–ª–∂–∏–º?',
             '–í–µ—Å—å–º–∞ –Ω–µ–¥—É—Ä–Ω–æ! sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º –ø–æ–∫–æ—Ä—è—Ç—å –≤–µ—Ä—à–∏–Ω—ã?',
             '–ù–µ–ø–ª–æ—Ö–æ–π —Ç–µ–º–ø, –Ω–æ –≤—Å—ë –µ—â—ë –≤–ø–µ—Ä–µ–¥–∏. –ü—Ä–æ–¥+–æ–ª–∂–∏–º? ',
             '–£–≤–µ—Ä–µ–Ω–Ω—ã–π —Ç–µ–º–ø! sil <[70]>–ü–æ–µ—Ö–∞–ª–∏ –¥–∞–ª—å—à–µ?',
             '–Ø –≤–∏–∂—É, sil <[70]> —Ç—ã –æ—á–µ–Ω—å —É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫.sil <[70]>–ü–æ–µ—Ö–∞–ª–∏ –¥–∞–ª—å—à–µ?'
             ]
        )

    else:
        rating_tts_only += random.choice(["–£ —Ç–µ–±—è –ø–æ –Ω—É–ª—è–º.",
                                         "–£ —Ç–µ–±—è –Ω–æ–ª—å –±–∞–ª–ª–æ–≤."
                                         ])
        rating_message += random.choice(
            ['–ù–µ –≥—É—Å—Ç–æ. sil <[70]>–ù–∞—á–Ω—ë–º –ø–æ–∫–æ—Ä—è—Ç—å –≤–µ—Ä—à–∏–Ω—ã?',
             '–ú–∞–ª–æ–≤–∞—Ç–æ –±—É–¥–µ—Ç. sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º –∏–≥—Ä—É, —á—Ç–æ–± —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?',
             '–£–≤–µ—Ä–µ–Ω–∞, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –Ω–∞ –±+–æ–ª—å—à–µ–µ. sil <[70]>–ü—Ä–æ–¥+–æ–ª–∂–∏–º –∏–≥—Ä—É, —á—Ç–æ–± —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?',
             ]
        )

    return rating_tts_only, rating_message
